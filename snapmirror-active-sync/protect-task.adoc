---
sidebar: sidebar 
permalink: snapmirror-active-sync/protect-task.html 
keywords: SM-BC, snapmirror business continuity, consistency group, remote protection, destination, scsi, nvme 
summary: Configurar la protección para la continuidad empresarial implica seleccionar LUN en el clúster de origen de ONTAP y añadirlas a un grupo de consistencia. 
---
= Protéjase con la sincronización activa de ONTAP SnapMirror
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapMirror active sync ofrece protección asimétrica y, a partir de ONTAP 9.15.1, protección activo-activo simétrica.



== Configurar la protección asimétrica

La configuración de la protección asimétrica mediante SnapMirror Active Sync implica seleccionar las LUN en el clúster de origen de ONTAP y añadirlas a un grupo de coherencia.

.Antes de empezar
* Debe tener una licencia síncrona de SnapMirror.
* Debe ser un administrador de clústeres o máquinas virtuales de almacenamiento.
* Todos los volúmenes constituyentes de un grupo de coherencia deben estar en una única máquina virtual de almacenamiento (SVM).
+
** Los LUN pueden residir en distintos volúmenes.


* Los clústeres de origen y destino no pueden ser los mismos.
* No es posible establecer relaciones de grupos de consistencia de sincronización activa de SnapMirror entre clústeres de ASA y clústeres no-ASA.
* El espacio IP predeterminado es necesario en la sincronización activa de SnapMirror para las relaciones entre iguales de clústeres. No se admite el espacio IP personalizado.
* El nombre del grupo de coherencia debe ser único.
* Los volúmenes en el clúster secundario (de destino) deben ser del tipo DP.
* Las SVM principales y secundarias deben estar en una relación entre iguales.


.Pasos
Puede configurar un grupo de coherencia con la CLI de ONTAP o System Manager.

A partir de ONTAP 9.10.1, ONTAP ofrece un punto final de grupo de consistencia y un menú en el Administrador del sistema, con utilidades de administración adicionales. Si utiliza ONTAP 9.10.1 o posterior, consulte link:../consistency-groups/configure-task.html["Configurar un grupo de consistencia"] entonces link:../consistency-groups/protect-task.html["configure la protección"] para crear una relación de sincronización activa de SnapMirror .


IMPORTANT: Desde ONTAP 9.14.1 hasta 9.8, la sincronización activa de SnapMirror se conoce como SnapMirror Business Continuity (SM-BC).

[role="tabbed-block"]
====
.System Manager
--
. En el clúster principal, navegue hasta *Protección > Descripción general > Proteger para continuidad empresarial > Proteger LUN*.
. Seleccione las LUN que desea proteger y añádalas a un grupo de protección.
. Seleccione el clúster y la SVM de destino.
. *La opción inicializar relación* está seleccionada de forma predeterminada. Haga clic en *Guardar* para comenzar la protección.
. Vaya a *Consola > rendimiento* para verificar la actividad de IOPS de las LUN.
. En el clúster de destino, utilice System Manager para comprobar que la protección de la relación de continuidad de negocio está sincronizada: *Protección > Relaciones*.


--
.CLI
--
. Cree una relación de grupo de coherencia a partir del clúster de destino.
`destination::> snapmirror create -source-path _source-path_ -destination-path _destination-path_ -cg-item-mappings _volume-paths_ -policy _policy-name_`
+
Puede asignar hasta 12 volúmenes constituyentes con `cg-item-mappings` el parámetro en el `snapmirror create` comando.

+
En el siguiente ejemplo se crean dos grupos de consistencia: `cg_src_ on the source with `vol1` Y `vol2` un grupo de coherencia de destino reflejado, `cg_dst`.

+
`destination::> snapmirror create -source-path vs1_src:/cg/cg_src -destination-path vs1_dst:/cg/cg_dst -cg-item-mappings vol_src1:@vol_dst1,vol_src2:@vol_dst2 -policy AutomatedFailOver`

. Desde el clúster de destino, inicialice el grupo de coherencia.
+
`destination::>snapmirror initialize -destination-path _destination-consistency-group_`

. Confirme que la operación de inicialización se ha realizado correctamente. El estado debe ser `InSync`.
+
`snapmirror show`

. En cada clúster, cree un igroup para poder asignar las LUN al iniciador en el host de la aplicación.
`lun igroup create -igroup _name_ -protocol _fcp|iscsi_ -ostype _os_ -initiator _initiator_name_`
+
Obtenga más información sobre `lun igroup create` en el link:https://docs.netapp.com/us-en/ontap-cli/lun-igroup-create.html["Referencia de comandos del ONTAP"^].

. En cada clúster, asigne las LUN al igroup:
+
`lun map -path _path_name_ -igroup _igroup_name_`

. Compruebe que la asignación de LUN se ha completado correctamente con `lun map` el comando. Luego, puede detectar las nuevas LUN en el host de la aplicación.


--
====


== Configurar la protección activo-activo simétrica

Puede establecer una protección simétrica mediante System Manager o la interfaz de línea de comandos de ONTAP. En ambas interfaces, hay diferentes pasos para xref:index.html#key-concepts[configuraciones uniformes y no uniformes].

.Antes de empezar
* Ambos clústeres deben ejecutar ONTAP 9.15.1 o una versión posterior.
* Las configuraciones activo-activo simétricas requieren `AutomatedFailoverDuplex` la política de protección. Alternativamente, usted puede xref:../data-protection/create-custom-replication-policy-concept.html[Crear una política de SnapMirror personalizada] siempre que el `-type` IS `automated-failover-duplex`.
* En ONTAP 9.15.1, el activo-activo simétrico solo se admite en clústeres de 2 nodos.
* A partir de ONTAP 9.16.1 GA, la sincronización activa de SnapMirror admite configuraciones activo-activo simétricas en clústeres de cuatro nodos.
+
** Para utilizar la sincronización activa de SnapMirror en un clúster de cuatro nodos, debe ejecutar ONTAP 9.16.1 GA o una versión posterior.
** Antes de implementar una configuración de cuatro nodos, xref:../peering/create-cluster-relationship-93-later-task.adoc[cree una relación de paridad entre clústeres]debe .
** xref:limits-reference.adoc[límites]Revise la para ver clústeres de cuatro nodos.
** Si revierte a un clúster de dos nodos, debe eliminar las relaciones de sincronización activa de SnapMirror del clúster antes de revertir.
** La configuración de cuatro nodos se puede usar para actualizar el almacenamiento y las controladoras. Este proceso no produce interrupciones y amplía el clúster mientras traslada los volúmenes a los nuevos nodos. Para obtener más información, consulte link:upgrade-revert-task.html#refresh-a-cluster["actualice un clúster"].


* A partir de ONTAP 9.17.1, puede configurar la protección activa/activa simétrica en espacios de nombres NVMe solo cuando ambos clústeres ejecutan ONTAP 9.17.1 o posterior.




== Configurar la protección activa/activa simétrica mediante una configuración de sincronización activa SCSI SnapMirror

.Pasos
Puede utilizar el Administrador del sistema o la CLI de ONTAP para configurar la protección activa/activa simétrica mediante asignaciones de host del protocolo SCSI.

[role="tabbed-block"]
====
.System Manager
--
.Pasos para una configuración uniforme
. En el sitio principal, link:../consistency-groups/configure-task.html#create-a-consistency-group-with-new-luns-or-volumes["Cree un grupo de consistencia mediante nuevas LUN."^]
+
.. Al crear el grupo de consistencia, especifique iniciadores de host para crear iGroups.
.. Seleccione la casilla de verificación **Activar SnapMirror** y luego elija la `AutomatedFailoverDuplex` política.
.. En el cuadro de diálogo que aparece, seleccione la casilla **Replicar iGroups** para replicar iGroups. En **Editar ajustes de proximidad**, establezca SVM proximales para sus hosts.
.. Selecciona **Guardar**.




.Pasos para una configuración no uniforme
. En el sitio principal, link:../consistency-groups/configure-task.html#create-a-consistency-group-with-new-luns-or-volumes["Cree un grupo de consistencia mediante nuevas LUN."^]
+
.. Al crear el grupo de consistencia, especifique iniciadores de host para crear iGroups.
.. Seleccione la casilla de verificación **Activar SnapMirror** y luego elija la `AutomatedFailoverDuplex` política.
.. Seleccione **Guardar** para crear las LUN, el grupo de consistencia, el igroup, la relación de SnapMirror y el mapa del igroup.


. En el sitio secundario, cree un igroup y asigne las LUN.
+
.. Vaya a **HOSTS** > **SAN Initiator Groups**.
.. Seleccione **+Add** para crear un igroup nuevo.
.. Proporcione un **Nombre**, seleccione el **Sistema Operativo del Host** y, a continuación, elija **Miembros del Grupo Iniciador**.
.. Seleccione **Guardar** para inicializar la relación.


. Asigne el nuevo igroup a las LUN de destino.
+
.. Vaya a **Almacenamiento** > **LUN**.
.. Seleccione todas las LUN que desea asignar al igroup.
.. Seleccione **Más** y luego **Asignar a grupos de iniciadores**.




--
.CLI
--
.Pasos para una configuración uniforme
. Cree una nueva relación de SnapMirror que agrupe todos los volúmenes en la aplicación. Asegúrese de designar la `AutomatedFailOverDuplex` política para establecer la replicación de sincronización bidireccional.
+
`snapmirror create -source-path <source_path> -destination-path <destination_path> -cg-item-mappings <source_volume:@destination_volume> -policy AutomatedFailOverDuplex`

. Inicialice la relación de SnapMirror:
`snapmirror initialize -destination-path <destination-consistency-group>`
. Para confirmar que la operación se ha realizado correctamente, espere a que `Mirrored State` se muestre `SnapMirrored` como y el `Relationship Status` `Insync` como .
+
`snapmirror show -destination-path <destination_path>`

. En el host, configure la conectividad de host con acceso a cada clúster de acuerdo con sus necesidades.
. Establezca la configuración del igroup. Establezca las rutas preferidas para los iniciadores en el clúster local. Especifique la opción para replicar la configuración en el cluster peer para afinidad inversa.
+
`SiteA::> igroup create -vserver <svm_name> -ostype <os_type> -igroup <igroup_name> -replication-peer <peer_svm_name> -initiator <host>`

+

NOTE: A partir de ONTAP 9.16.1, utilice `-proximal-vserver local` el parámetro en este comando.

+
`SiteA::> igroup add -vserver <svm_name> -igroup <igroup_name> -ostype <os_type> -initiator <host>`

+

NOTE: A partir de ONTAP 9.16.1, utilice `-proximal-vserver peer` el parámetro en este comando.

. Desde el host, detecte las rutas y verifique que los hosts tengan una ruta activa/optimizada hacia el LUN de almacenamiento desde el clúster preferido.
. Ponga en marcha la aplicación y distribuya las cargas de trabajo de los equipos virtuales entre los clusters para lograr el equilibrio de carga necesario.


.Pasos para una configuración no uniforme
. Cree una nueva relación de SnapMirror que agrupe todos los volúmenes en la aplicación. Asegúrese de designar la `AutomatedFailOverDuplex` política para establecer la replicación de sincronización bidireccional.
+
`snapmirror create -source-path <source_path> -destination-path <destination_path> -cg-item-mappings <source_volume:@destination_volume> -policy AutomatedFailOverDuplex`

. Inicialice la relación de SnapMirror:
`snapmirror initialize -destination-path <destination-consistency-group>`
. Para confirmar que la operación se ha realizado correctamente, espere a que `Mirrored State` se muestre `SnapMirrored` como y el `Relationship Status` `Insync` como .
+
`snapmirror show -destination-path <destination_path>`

. En el host, configure la conectividad de host con acceso a cada clúster de acuerdo con sus necesidades.
. Establezca las configuraciones de igroups en los clústeres de origen y destino.
+
`# primary site
SiteA::> igroup create -vserver <svm_name> -igroup <igroup_name> -initiator <host_1_name_>`

+
`# secondary site
SiteB::> igroup create -vserver <svm_name> -igroup <igroup_name> -initiator <host_2_name>`

. Desde el host, detecte las rutas y verifique que los hosts tengan una ruta activa/optimizada hacia el LUN de almacenamiento desde el clúster preferido.
. Ponga en marcha la aplicación y distribuya las cargas de trabajo de los equipos virtuales entre los clusters para lograr el equilibrio de carga necesario.


--
====


== Configurar la protección activa/activa simétrica mediante una configuración de sincronización activa de NVMe SnapMirror

.Antes de empezar
Además de los requisitos para configurar la protección activa/activa simétrica, debe tener en cuenta las configuraciones compatibles y no compatibles al utilizar el protocolo NVMe.

* Los grupos de consistencia pueden tener uno o más subsistemas.
* Los volúmenes dentro del grupo de consistencia pueden tener mapas de espacios de nombres de múltiples subsistemas.
* Los subsistemas no pueden tener mapas de espacios de nombres que pertenezcan a más de un grupo de consistencia.
* Los subsistemas no pueden tener algunos mapas de espacios de nombres que pertenezcan a un grupo de consistencia y algunos mapas de espacios de nombres que no pertenezcan a un grupo de consistencia.
* Los subsistemas deben tener mapas de espacios de nombres que sean parte del mismo grupo de consistencia.


.Pasos
A partir de ONTAP 9.17.1, puede usar el Administrador del sistema o la CLI de ONTAP para crear un grupo de consistencia y configurar la protección activa/activa simétrica mediante asignaciones de host del protocolo NVMe.

[role="tabbed-block"]
====
.System Manager
--
. En el sitio principal, link:../consistency-groups/configure-task.html#create-a-consistency-group-with-new-luns-or-volumes["crear un grupo de consistencia utilizando nuevos volúmenes o espacios de nombres NVMe."^]
. Seleccione *+Agregar* y elija *Usar nuevos espacios de nombres NVMe*.
. Introduzca el nombre del grupo de consistencia.
. Seleccione *Más*.
. En la sección *Protección*, seleccione *Habilitar SnapMirror* y luego elija la opción  `AutomatedFailoverDuplex` política.
. En la sección *Mapeo de host*, elija *Subsistema NVMe existente* o *Nuevo subsistema NVMe*.
. Seleccione "En proximidad a" para cambiar el SVM proximal. El SVM de origen está seleccionado por defecto.
. Si es necesario, agregue otro subsistema NVMe.


--
.CLI
--
. Cree una nueva relación SnapMirror que agrupe todos los volúmenes que contienen todos los espacios de nombres NVMe utilizados por la aplicación. Asegúrese de designar el  `AutomatedFailOverDuplex` Política para establecer replicación de sincronización bidireccional.
+
`snapmirror create -source-path <source_path> -destination-path <destination_path> -cg-item-mappings <source_volume:@destination_volume> -policy AutomatedFailOverDuplex`

+
Ejemplo:

+
[listing]
----
DST::> snapmirror create -source-path vs_src:/cg/cg_src_1 -destination-path vs_dst:/cg/cg_dst_1 -cg-item-mappings vs_src_vol1:@vs_dst_vol1,vs_src_vol2:@vs_dst_vol2 -policy AutomatedFailOverDuplex
----
. Inicialice la relación de SnapMirror:
`snapmirror initialize -destination-path <destination-consistency-group>`
+
Ejemplo:

+
[listing]
----
DST::> snapmirror initialize -destination-path vs1:/cg/cg_dst_1
----
. Para confirmar que la operación se ha realizado correctamente, espere a que `Mirrored State` se muestre `SnapMirrored` como y el `Relationship Status` `Insync` como .
+
`snapmirror show -destination-path <destination_path>`

+
Los subsistemas NVMe asociados con los espacios de nombres NVMe en los volúmenes principales se replican automáticamente en el clúster secundario.

. En el host, configure la conectividad de host con acceso a cada clúster de acuerdo con sus necesidades.
. Especifique la SVM próxima a cada uno de sus hosts. Esto permite que el host acceda al espacio de nombres NVMe mediante una ruta desde el clúster preferido. Esta podría ser la SVM del clúster principal o la SVM del clúster de recuperación ante desastres.
+
El siguiente comando indica que SVM VS_A es proximal al host H1 y establece VS_A como SVM proximal:

+
`SiteA::> vserver nvme subsystem host add -subsystem ss1 -host-nqn <H1_NQN> -proximal-vservers <VS_A>`

+
El siguiente comando indica que SVM VS_B es proximal al host H2 y establece VS_B como SVM proximal:

+
`SiteB::> vserver nvme subsystem host add -subsystem ss1 -host-nqn <H2_NQN> -proximal-vservers <VS_B>`

. Desde el host, descubra las rutas y verifique que los hosts tengan una ruta activa/optimizada al almacenamiento desde el clúster preferido.
. Ponga en marcha la aplicación y distribuya las cargas de trabajo de los equipos virtuales entre los clusters para lograr el equilibrio de carga necesario.


--
====
.Información relacionada
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-create.html["snapmirror create"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-initialize.html["inicializar snapmirror"^]
* link:https://docs.netapp.com/us-en/ontap-cli/snapmirror-show.html["espectáculo de Snapmirror"^]

