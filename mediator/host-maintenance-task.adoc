---
permalink: mediator/host-maintenance-task.html 
sidebar: sidebar 
keywords: mediator, maintain, host, maintenance, package update, kernel upgrade, change hostname, change IP, self-signed certificate, self signed certificate 
summary: Mantenga el sistema operativo host de ONTAP Mediator periódicamente para lograr un rendimiento óptimo. 
---
= Mantenga el SO del host para ONTAP Mediator
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Mantenga el sistema operativo host de ONTAP Mediator periódicamente para lograr un rendimiento óptimo.



== Reinicie el host

Reinicie el host solo cuando los clústeres estén en buen estado.  Los clústeres no pueden responder a fallas mientras ONTAP Mediator está fuera de línea.  Programe una ventana de servicio antes de reiniciar.

ONTAP Mediator se reanuda automáticamente durante un reinicio y vuelve a ingresar a las relaciones configuradas previamente con los clústeres de ONTAP .



== Actualizaciones del paquete de host

Actualice cualquier biblioteca o paquete yum excepto el kernel.  Reinicie el host si es necesario para que los cambios surtan efecto.  Programe una ventana de servicio antes de reiniciar el host.

Si instala `yum-utils` el paquete, utilice el `needs-restarting` comando para detectar si algún cambio de paquete requiere un reinicio.

Reinicie después de actualizar las dependencias de ONTAP Mediator porque los cambios no tienen efecto inmediato.



== Actualizaciones del kernel inferiores del sistema operativo host

Se debe compilar SCST para el núcleo que se está utilizando. Para actualizar el sistema operativo, se necesita una ventana de mantenimiento.

.Pasos
Realice los siguientes pasos para actualizar el kernel del sistema operativo host.


NOTE: Antes de actualizar el kernel, verifique que el sistema operativo y la versión de ONTAP Mediator sean compatibles.  Para conocer las versiones compatibles, consulte lalink:whats-new-concept.html#os-support-matrix["Matriz de compatibilidad de SO"] .

. Detener el mediador de ONTAP.
. Desinstale el paquete SCST, consulte<<Realizar mantenimiento del host>> .  (SCST no proporciona un mecanismo de actualización).
. Actualice el sistema operativo y reinicie.
. Vuelva a instalar el paquete SCST.
. Vuelva a habilitar ONTAP Mediator.




== Realizar mantenimiento del host

Actualizar el kernel de la máquina virtual puede causar problemas de compatibilidad con los módulos SCST.  Desinstale y vuelva a instalar SCST manualmente.



=== Paso 1: Desinstalar SCST

Para desinstalar SCST, utilice el paquete tar correspondiente a su versión de ONTAP Mediator.

.Pasos
. Descargue el paquete SCST apropiado (como se muestra en la siguiente tabla) y extráigalo.
+
[cols="50,50"]
|===


| Para esta versión... | Usar este paquete tar... 


 a| 
Mediador ONTAP 1.10
 a| 
scst-3.9.tar.gz



 a| 
Mediador ONTAP 1.9.1
 a| 
scst-3,8.0.tar.bz2



 a| 
Mediador ONTAP 1,9
 a| 
scst-3,8.0.tar.bz2



 a| 
Mediador ONTAP 1,8
 a| 
scst-3,8.0.tar.bz2



 a| 
Mediador ONTAP 1,7
 a| 
scst-3,7.0.tar.bz2



 a| 
Mediador ONTAP 1,6
 a| 
scst-3,7.0.tar.bz2



 a| 
Mediador ONTAP 1,5
 a| 
scst-3,6.0.tar.bz2



 a| 
Mediador ONTAP 1,4
 a| 
scst-3,6.0.tar.bz2



 a| 
Mediador ONTAP 1,3
 a| 
scst-3,5.0.tar.bz2



 a| 
Mediador ONTAP 1,1
 a| 
scst-3,4.0.tar.bz2



 a| 
Mediador ONTAP 1,0
 a| 
scst-3,3.0.tar.bz2

|===
+
.. Acceda al paquete de código abierto desdelink:https://scst.sourceforge.net/downloads.html["Descargas de sourceforge de SCST"^] .
.. Seleccione *Descargar versiones lanzadas*.
.. Extraiga el paquete a su máquina virtual.


. Ejecute los siguientes comandos de desinstalación en el `scst` directorio:
+
.. `systemctl stop mediator-scst`
.. `make scstadm_uninstall`
.. `make iscsi_uninstall`
.. `make usr_uninstall`
.. `make scst_uninstall`
.. `depmod`






=== Paso 2: Instalar SCST

Para instalar SCST manualmente, necesita el paquete tar de SCST que se utiliza para la versión instalada de ONTAP Mediator (consulte la<<scst-bundle-table,Tabla SCST>> ).


NOTE: Realice este paso antes de instalar ONTAP Mediator.  Si la versión de SCST que está utilizando es más nueva que la versión incluida con el instalador de ONTAP Mediator, el instalador omite este paso.

. Ejecute los siguientes comandos de instalación en el `scst` directorio:
+
.. `make 2release`
.. `make scst_install`
.. `make usr_install`
.. `make iscsi_install`
.. `make scstadm_install`
.. `depmod`
+
[NOTE]
====
Si está realizando una instalación por primera vez y desea preinstalar ONTAP Mediator, ejecute el siguiente comando antes de continuar con el siguiente paso:

`mkdir -p /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys`

====
.. `cp scst/src/certs/scst_module_key.der /opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/`
.. `patch /etc/init.d/scst < /opt/netapp/lib/ontap_mediator/systemd/scst.patch`
+

NOTE: Si preinstala SCST antes de ONTAP Mediator durante una primera instalación, omita este paso.  El instalador aplica los parches SCST relevantes.



. Opcionalmente, si Secure Boot está activado, antes de reiniciar, realice los siguientes pasos:
+
.. Determinar cada nombre de archivo para el `scst_vdisk` , `scst` , y `iscsi_scst` módulos:
+
....
[root@localhost ~]# modinfo -n scst_vdisk
[root@localhost ~]# modinfo -n scst
[root@localhost ~]# modinfo -n iscsi_scst
....
.. Determine la versión del kernel:
+
....
[root@localhost ~]# uname -r
....
.. Firme cada archivo de módulo con el kernel:
+
....
[root@localhost ~]# /usr/src/kernels/<KERNEL-RELEASE>/scripts/sign-file \sha256 \
/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.priv \
/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.der \
_module-filename_
....
.. Instale la clave UEFI con el firmware.
+
Las instrucciones para instalar la clave UEFI se encuentran en:

+
`/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/README.module-signing`

+
La clave UEFI generada se encuentra en:

+
`/opt/netapp/lib/ontap_mediator/ontap_mediator/SCST_mod_keys/scst_module_key.der`



. Reiniciar el sistema:
+
`reboot`





== El host cambia al nombre de host o IP

.Acerca de esta tarea
* Realice esta tarea en el host Linux donde instaló ONTAP Mediator.
* Realice esta tarea solo si los certificados autofirmados están obsoletos porque el nombre de host o la dirección IP cambiaron después de instalar ONTAP Mediator.
* Una vez que el certificado autofirmado temporal haya sido reemplazado por un certificado de terceros confiable, _no_ utilice esta tarea para regenerar un certificado.  Si no tiene un certificado autofirmado, no puede utilizar este procedimiento.


.Paso
Cree un certificado autofirmado temporal para el host actual:

. Reiniciar ONTAP Mediator:
+
`./make_self_signed_certs.sh overwrite`

+
[listing]
----
[root@xyz000123456 ~]# cd /opt/netapp/lib/ontap_mediator/ontap_mediator/server_config
[root@xyz000123456 server_config]# ./make_self_signed_certs.sh overwrite

Adding Subject Alternative Names to the self-signed server certificate
#
# OpenSSL example configuration file.
Generating self-signed certificates
Generating RSA private key, 4096 bit long modulus (2 primes)
..................................................................................................................................................................++++
........................................................++++
e is 65537 (0x010001)
Generating a RSA private key
................................................++++
.............................................................................................................................................++++
writing new private key to 'ontap_mediator_server.key'
-----
Signature ok
subject=C = US, ST = California, L = San Jose, O = "NetApp, Inc.", OU = ONTAP Core Software, CN = ONTAP Mediator, emailAddress = support@netapp.com
Getting CA Private Key

[root@xyz000123456 server_config]# systemctl restart ontap_mediator
----

