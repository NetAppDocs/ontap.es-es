---
sidebar: sidebar 
permalink: s3-snapshots/list-restore-s3-snapshot.html 
keywords: s3 snapshots, list, restore, browse S3 snapshots 
summary: La función de copias Snapshot de ONTAP S3 permite ver, examinar y restaurar el contenido de copias Snapshot de S3 de los bloques de clientes S3. 
---
= Ver y restaurar copias Snapshot de ONTAP S3
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
A partir de ONTAP 9.16.1, puede ver y explorar los datos de instantáneas de S3 para sus buckets desde clientes S3.  A partir de ONTAP 9.18.1, el bucket de instantáneas S3 es accesible de forma nativa con la CLI de ONTAP .  Además, puede restaurar un solo objeto, un conjunto de objetos o un bucket completo en un cliente S3 a partir de una instantánea de S3.

.Antes de empezar
* Todos los nodos del clúster deben estar ejecutando ONTAP 9.18.1 o posterior antes de poder realizar la operación de restauración de instantáneas de bucket de forma nativa en la CLI de ONTAP .  A partir de ONTAP 9.18.1, el navegador S3 ya no es necesario, pero las operaciones siguen siendo compatibles.
* Solo se permite una operación de restauración de instantánea a la vez en un bucket determinado.


.Acerca de esta tarea
A partir de ONTAP 9.16.1, la función de instantáneas de ONTAP S3 proporciona funcionalidad básica de instantáneas para los buckets de ONTAP S3, incluyendo la creación y eliminación manual y programada de instantáneas, políticas de instantáneas para buckets de S3 y exploración de instantáneas basada en cliente S3.

A partir de ONTAP 9.18.1, se agrega soporte para la restauración nativa de instantáneas de ONTAP , lo que proporciona a los administradores de ONTAP la funcionalidad de restauración a un punto específico en el tiempo sin utilizar un explorador S3.  En la instantánea solo se captura la versión actual del bucket.  El historial de versiones no se captura y no se restaurará mediante la operación de restauración de instantáneas de S3.



== Enumere y vea S3 instantáneas

Puede ver los detalles de la instantánea de S3, compararlos e identificar errores. Con la interfaz de línea de comandos de ONTAP, puede enumerar todas las copias Snapshot creadas en los bloques de S3.

.Pasos
. Enumerar S3 snapshots:
+
[listing]
----
vserver object-store-server bucket snapshot show
----
+
Puedes ver los nombres de las instantáneas, las máquinas virtuales de almacenamiento, los buckets, las horas de creación y los UUID de instancia de las instantáneas de S3 creadas para todos tus buckets en el clúster.

. También puede especificar un nombre de bucket para ver los nombres, las horas de creación y los UUID de instancia de todas las instantáneas de S3 creadas para ese bucket específico.
+
[listing]
----
vserver object-store-server bucket snapshot show -vserver <svm_name> -bucket <bucket_name>
----




== Examine el contenido de S3 instantáneas

Si observa algún fallo o problema en su entorno, puede examinar el contenido de las instantáneas del bloque S3 para identificar los errores. También puede examinar las instantáneas de S3 para determinar el contenido sin errores que desea restaurar.

Las instantáneas de S3 se presentan como buckets de instantáneas a los clientes de S3.  El nombre del bucket de instantáneas tiene el siguiente formato: `<base_bucket_name>-s3snap-<snapshot_name>` .  Puedes ver todos los buckets de instantáneas en una máquina virtual de almacenamiento usando la `ListBuckets` Funcionamiento de la API S3.

El bucket de instantáneas de S3 hereda las políticas de acceso del bucket base y solo admite operaciones de solo lectura.  Las operaciones de borrado y escritura están prohibidas.  Si tiene permisos para acceder al bucket base, también puede realizar operaciones de API de S3 de solo lectura en el bucket de instantáneas de S3, como por ejemplo: `HeadObject` , `GetObject` , `GetObjectTagging` , `ListObjects` , `ListObjectVersions` , `GetObjectAcl` , y `CopyObject` .


NOTE:  `CopyObject`La operación se admite en un depósito de instantáneas de S3 solo si se trata de una instantánea del depósito de origen, no si es el destino de almacenamiento de la instantánea.

Para obtener más información sobre estas operaciones, consulte link:../s3-config/ontap-s3-supported-actions-reference.html["Acciones compatibles con ONTAP S3"].



== Restaurar un bucket a partir de instantáneas de S3 mediante ONTAP

A partir de ONTAP 9.18.1, puede usar la CLI de ONTAP para restaurar un bucket completo usando una instantánea de ONTAP S3.  Solo puedes restaurar la versión del bucket que existía en el momento en que se creó la instantánea seleccionada.

.Pasos
. Identifique la instantánea que desea usar para restaurar el bucket:
+
[listing]
----
vserver object-store-server bucket snapshot show
----
. Restaurar el cubo:
+
[listing]
----
vserver object-store-server bucket snapshot restore start -vserver <storage VM name> -bucket <bucket name> -snapshot <snapshot name>
----




== Restaurar datos desde instantáneas de buckets de S3 utilizando un cliente de S3

Además de restaurar un bucket completo en ONTAP, también puede restaurar un solo objeto, un conjunto de objetos o un bucket completo desde una instantánea de S3 utilizando un cliente de S3 como S3cmd o S3 Browser.

link:index.html#snapshots-on-versioned-and-non-versioned-buckets["Obtenga más información sobre las instantáneas con y sin versiones."]

Puede restaurar todo el bucket, objetos con un prefijo determinado o un solo objeto utilizando la `aws s3 cp` dominio.

.Pasos
. Tome una instantánea del cubo base S3.
+
[source, cli]
----
vserver object-store-server bucket snapshot create -vserver <svm_name> -bucket <base_bucket_name> -snapshot <snapshot_name>
----
. Restaure el bloque base mediante la copia de Snapshot:
+
** Restaure un bloque completo. Utilice el nombre del depósito de instantáneas con el formato `<base_bucket_name>-s3snap-<snapshot_name>`.
+
[source, cli]
----
aws --endpoint http://<IP> s3 cp s3://<snapshot-bucket-name> s3://<base-bucket>  --recursive
----
** Restaurar objetos en un directorio con el prefijo `dir1`:
+
[source, cli]
----
aws --endpoint http://<IP> s3 cp s3://<snapshot-bucket-name>/dir1 s3://<base_bucket_name>/dir1 --recursive
----
** Restaurar un solo objeto llamado `web.py`:
+
[source, cli]
----
aws --endpoint http://<IP> s3 cp s3:// <snapshot-bucket-name>/web.py s3://<base_bucket_name>/web.py
----



